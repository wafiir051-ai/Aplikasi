<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AETHER-T | Singularity</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@100;400;900&family=Space+Mono&display=swap');

        :root {
            --bg: #000000;
            --accent: #00f2ff;
            --accent-alt: #ff007a;
            --font-main: 'Outfit', sans-serif;
            --font-mono: 'Space Mono', monospace;
            --bloom: 0 0 20px rgba(0, 242, 255, 0.5);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            font-family: var(--font-main);
            margin: 0; padding: 0; overflow: hidden;
            background-color: var(--bg);
            color: #fff;
            height: 100dvh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* --- HYPER-MODERN BACKGROUND --- */
        #bg-canvas {
            position: fixed; inset: 0; z-index: -2;
            filter: contrast(1.2) brightness(0.8);
        }

        .vignette {
            position: fixed; inset: 0; z-index: -1;
            background: radial-gradient(circle at center, transparent 20%, rgba(0,0,0,0.8) 100%);
            pointer-events: none;
        }

        /* --- LOADER --- */
        #loader {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s ease;
        }

        .loader-ring {
            width: 80px; height: 80px; border: 2px solid transparent;
            border-top: 2px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s cubic-bezier(0.5, 0, 0.5, 1) infinite;
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- UI SCREENS --- */
        .screen {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: all 1s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 10;
        }

        .hidden { opacity: 0; transform: scale(1.1) rotateX(10deg); pointer-events: none; filter: blur(20px); }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 40px;
            padding: 40px;
            width: 90%; max-width: 400px;
            text-align: center;
            box-shadow: 0 40px 100px rgba(0,0,0,0.5);
        }

        .title-group h1 {
            font-size: 4.5rem; font-weight: 900; margin: 0;
            letter-spacing: -5px; line-height: 0.9;
            background: linear-gradient(180deg, #fff 0%, rgba(255,255,255,0.2) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }

        .btn-modern {
            width: 100%; padding: 20px; border-radius: 20px;
            border: none; background: #fff; color: #000;
            font-weight: 900; letter-spacing: 2px; cursor: pointer;
            transition: 0.3s cubic-bezier(0.2, 1, 0.3, 1);
            margin-top: 20px;
        }

        .btn-modern:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(255,255,255,0.2); }
        .btn-modern:active { transform: scale(0.95); }

        /* --- GAMEPLAY --- */
        #game-screen {
            max-width: 500px; padding: 20px;
            justify-content: space-between;
        }

        .stats-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr;
            width: 100%; padding: 15px; background: rgba(255, 255, 255, 0.05);
            border-radius: 25px; border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-item span:first-child { font-size: 0.5rem; opacity: 0.5; display: block; letter-spacing: 2px; }
        .stat-item span:last-child { font-size: 1.2rem; font-weight: 900; color: var(--accent); font-family: var(--font-mono); }

        #tetris-container {
            position: relative; margin: 20px 0;
        }

        canvas#tetris {
            background: rgba(0, 0, 0, 0.4); border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            max-height: 65dvh;
            transition: transform 0.1s ease;
        }

        .controls {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
            width: 100%;
        }

        .ctrl-btn {
            height: 60px; border-radius: 18px; border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05); color: #fff; font-size: 1.2rem;
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .ctrl-btn:active { background: var(--accent); color: #000; transform: scale(0.9); }

        /* Modal Overlays */
        #game-over-screen {
            position: fixed; inset: 0; background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px); z-index: 100;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }

    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>
    <div class="vignette"></div>

    <div id="loader">
        <div class="loader-ring"></div>
        <p style="margin-top: 20px; font-size: 0.6rem; letter-spacing: 5px; opacity: 0.5;">SINGULARITY CORE LOADING</p>
    </div>

    <!-- HOME SCREEN -->
    <div id="home-screen" class="screen">
        <div class="glass-panel">
            <div class="title-group">
                <span style="font-size: 0.6rem; letter-spacing: 8px; opacity: 0.5;">PROYEK</span>
                <h1 id="main-title">AETHER</h1>
                <span style="font-size: 0.5rem; letter-spacing: 12px; color: var(--accent);">SINGULARITAS</span>
            </div>

            <div style="margin: 40px 0;">
                <input type="text" id="username" value="PLAYER_01" style="background:none; border:none; border-bottom:1px solid rgba(255,255,255,0.2); color:#fff; text-align:center; width:100%; padding:10px; font-family:var(--font-mono); font-size:0.8rem;">
            </div>

            <div id="best-score-container" style="margin-bottom: 30px;">
                <p style="font-size: 0.5rem; opacity: 0.4; letter-spacing: 3px; margin:0;">REKOR LOKAL</p>
                <h2 id="high-score-ui" style="font-size: 2.5rem; margin:0; font-weight: 100; font-family: var(--font-mono);">0000</h2>
            </div>

            <button class="btn-modern" onclick="initGame()">MASUK SISTEM</button>
        </div>
    </div>

    <!-- GAME SCREEN -->
    <div id="game-screen" class="screen hidden">
        <div class="stats-grid">
            <div class="stat-item">
                <span>PENGGUNA</span>
                <span id="p-name">---</span>
            </div>
            <div style="text-align: center;" class="stat-item">
                <span>DATA</span>
                <span id="score-val">0</span>
            </div>
            <div style="text-align: right;" class="stat-item">
                <span>LVL</span>
                <span id="level-val">01</span>
            </div>
        </div>

        <div id="tetris-container">
            <canvas id="tetris"></canvas>
        </div>

        <div class="controls">
            <div class="ctrl-btn" id="c-rotate-ccw"><i class="fa-solid fa-rotate-left"></i></div>
            <div class="ctrl-btn" id="c-hard" style="color:var(--accent)"><i class="fa-solid fa-angles-down"></i></div>
            <div class="ctrl-btn" id="c-rotate-cw"><i class="fa-solid fa-rotate-right"></i></div>
            <div class="ctrl-btn" id="c-left"><i class="fa-solid fa-chevron-left"></i></div>
            <div class="ctrl-btn" id="c-down"><i class="fa-solid fa-chevron-down"></i></div>
            <div class="ctrl-btn" id="c-right"><i class="fa-solid fa-chevron-right"></i></div>
        </div>
    </div>

    <!-- GAME OVER -->
    <div id="game-over-screen">
        <span style="color: var(--accent-alt); font-size: 0.6rem; letter-spacing: 5px;">KONEKSI TERPUTUS</span>
        <h1 style="font-size: 4rem; font-weight: 900; margin: 10px 0;">HALTED</h1>
        <div style="text-align:center; margin: 30px 0;">
            <p style="opacity:0.5; font-size:0.7rem;">DATA AKHIR</p>
            <h2 id="final-score" style="font-size: 3rem; font-family: var(--font-mono);">0</h2>
        </div>
        <button class="btn-modern" style="width: 200px;" onclick="initGame()">MASUK ULANG</button>
        <p onclick="location.reload()" style="margin-top:20px; font-size:0.6rem; opacity:0.3; cursor:pointer;">AKHIRI SESI</p>
    </div>

<script>
    // --- BACKGROUND ENGINE (Starfield & Parallax) ---
    const bgCanvas = document.getElementById('bg-canvas');
    const bgCtx = bgCanvas.getContext('2d');
    let stars = [];

    function resizeBG() {
        bgCanvas.width = window.innerWidth;
        bgCanvas.height = window.innerHeight;
        initStars();
    }

    function initStars() {
        stars = [];
        for(let i=0; i<200; i++) {
            stars.push({
                x: Math.random() * bgCanvas.width,
                y: Math.random() * bgCanvas.height,
                size: Math.random() * 2,
                speed: Math.random() * 0.5 + 0.1,
                opacity: Math.random()
            });
        }
    }

    function drawBG() {
        bgCtx.fillStyle = '#000';
        bgCtx.fillRect(0,0,bgCanvas.width, bgCanvas.height);
        
        stars.forEach(s => {
            bgCtx.fillStyle = `rgba(0, 242, 255, ${s.opacity})`;
            bgCtx.beginPath();
            bgCtx.arc(s.x, s.y, s.size, 0, Math.PI*2);
            bgCtx.fill();
            s.y += s.speed;
            if(s.y > bgCanvas.height) s.y = 0;
        });
        requestAnimationFrame(drawBG);
    }

    // --- TETRIS CORE ENGINE ---
    const canvas = document.getElementById('tetris');
    const ctx = canvas.getContext('2d');
    const COLS = 10, ROWS = 20, SCALE = 30;
    
    canvas.width = COLS * SCALE;
    canvas.height = ROWS * SCALE;
    ctx.scale(SCALE, SCALE);

    const SHAPES = [
        [],
        [[0,1,0],[1,1,1],[0,0,0]], [[2,2],[2,2]], [[0,3,3],[3,3,0],[0,0,0]], 
        [[4,4,0],[0,4,4],[0,0,0]], [[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]], 
        [[6,0,0],[6,6,6],[0,0,0]], [[0,0,7],[7,7,7],[0,0,0]]
    ];
    const COLORS = [null, '#00f2ff', '#ff007a', '#39ff14', '#7000ff', '#ffae00', '#007bff', '#ffffff'];

    let arena = Array.from({length: ROWS}, () => new Array(COLS).fill(0));
    let player = { pos: {x: 0, y: 0}, matrix: null, score: 0, level: 1 };
    let dropCounter = 0, dropInterval = 1000, lastTime = 0, isPaused = true;
    let particles = [];

    function initGame() {
        document.getElementById('p-name').innerText = document.getElementById('username').value.toUpperCase();
        document.getElementById('home-screen').classList.add('hidden');
        document.getElementById('game-over-screen').style.display = 'none';
        document.getElementById('game-screen').classList.remove('hidden');
        
        arena = Array.from({length: ROWS}, () => new Array(COLS).fill(0));
        player.score = 0; player.level = 1;
        document.getElementById('score-val').innerText = '0';
        document.getElementById('level-val').innerText = '01';
        
        playerReset();
        isPaused = false;
        lastTime = performance.now();
        requestAnimationFrame(gameLoop);
    }

    function playerReset() {
        const id = (Math.random() * (SHAPES.length - 1) | 0) + 1;
        player.matrix = SHAPES[id].map(row => [...row]); // Deep copy
        player.pos.y = 0;
        player.pos.x = (COLS / 2 | 0) - (player.matrix[0].length / 2 | 0);
        if (collide(arena, player)) {
            isPaused = true;
            document.getElementById('final-score').innerText = player.score;
            document.getElementById('game-over-screen').style.display = 'flex';
            if(player.score > (localStorage.getItem('aether_best') || 0)) {
                localStorage.setItem('aether_best', player.score);
                updateHighScore();
            }
        }
    }

    function collide(a, p) {
        const [m, o] = [p.matrix, p.pos];
        for (let y = 0; y < m.length; ++y) {
            for (let x = 0; x < m[y].length; ++x) {
                if (m[y][x] !== 0 && (a[y + o.y] && a[y + o.y][x + o.x]) !== 0) return true;
            }
        }
        return false;
    }

    function merge(a, p) {
        p.matrix.forEach((r, y) => r.forEach((v, x) => {
            if (v !== 0) {
                a[y + p.pos.y][x + p.pos.x] = v;
                createParticles(x + p.pos.x, y + p.pos.y, COLORS[v]);
            }
        }));
    }

    function createParticles(x, y, color) {
        for(let i=0; i<5; i++) {
            particles.push({
                x, y,
                vx: (Math.random() - 0.5) * 0.2,
                vy: (Math.random() - 0.5) * 0.2,
                life: 1.0,
                color: color
            });
        }
    }

    function arenaSweep() {
        let count = 0;
        outer: for (let y = arena.length - 1; y >= 0; --y) {
            for (let x = 0; x < arena[y].length; ++x) { if (arena[y][x] === 0) continue outer; }
            arena.splice(y, 1)[0].fill(0);
            arena.unshift(new Array(COLS).fill(0));
            ++y; count++;
        }
        if (count > 0) {
            player.score += [0, 100, 300, 800, 1500][count] * player.level;
            document.getElementById('score-val').innerText = player.score;
            player.level = Math.floor(player.score / 1500) + 1;
            document.getElementById('level-val').innerText = player.level.toString().padStart(2, '0');
            dropInterval = Math.max(100, 1000 - (player.level * 80));
            // Efek Flash
            canvas.style.filter = 'brightness(3) saturate(2)';
            setTimeout(() => canvas.style.filter = '', 100);
        }
    }

    function draw() {
        // Pembersihan halus
        ctx.fillStyle = 'rgba(0,0,0,0.5)';
        ctx.fillRect(0, 0, COLS, ROWS);

        // Garis Grid
        ctx.strokeStyle = 'rgba(255,255,255,0.02)';
        ctx.lineWidth = 0.05;
        for(let i=0; i<=COLS; i++) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,ROWS); ctx.stroke(); }
        for(let i=0; i<=ROWS; i++) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(COLS,i); ctx.stroke(); }

        // Arena
        arena.forEach((r, y) => r.forEach((v, x) => {
            if (v !== 0) drawBlock(x, y, COLORS[v]);
        }));

        // Ghost (Bayangan)
        if(player.matrix) {
            let gy = player.pos.y;
            while(!collide(arena, {pos:{x:player.pos.x, y:gy+1}, matrix:player.matrix})) gy++;
            ctx.globalAlpha = 0.05;
            player.matrix.forEach((r, y) => r.forEach((v, x) => {
                if(v!==0) drawBlock(x + player.pos.x, y + gy, '#fff');
            }));
            ctx.globalAlpha = 1;

            // Kepingan Pemain
            player.matrix.forEach((r, y) => r.forEach((v, x) => {
                if (v !== 0) drawBlock(x + player.pos.x, y + player.pos.y, COLORS[v], true);
            }));
        }

        // Partikel
        particles.forEach((p, i) => {
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life;
            ctx.fillRect(p.x, p.y, 0.1, 0.1);
            p.x += p.vx; p.y += p.vy;
            p.life -= 0.02;
            if(p.life <= 0) particles.splice(i, 1);
        });
        ctx.globalAlpha = 1;
    }

    function drawBlock(x, y, color, active = false) {
        const rad = 0.1;
        const grad = ctx.createRadialGradient(x+0.5, y+0.5, 0, x+0.5, y+0.5, 0.8);
        grad.addColorStop(0, color);
        grad.addColorStop(1, '#000');
        
        ctx.fillStyle = grad;
        if(active) {
            ctx.shadowBlur = 10;
            ctx.shadowColor = color;
        }
        
        ctx.beginPath();
        ctx.roundRect(x + 0.05, y + 0.05, 0.9, 0.9, rad);
        ctx.fill();
        ctx.shadowBlur = 0;
        
        // Kilauan
        ctx.fillStyle = 'rgba(255,255,255,0.3)';
        ctx.fillRect(x+0.2, y+0.2, 0.2, 0.1);
    }

    function gameLoop(time = 0) {
        if (isPaused) return;
        const dt = time - lastTime;
        lastTime = time;
        dropCounter += dt;
        if (dropCounter > dropInterval) {
            player.pos.y++;
            if (collide(arena, player)) {
                player.pos.y--;
                merge(arena, player);
                playerReset();
                arenaSweep();
            }
            dropCounter = 0;
        }
        draw();
        requestAnimationFrame(gameLoop);
    }

    // --- KONTROL ROTASI 360 DERAJAT ---
    function rotateM(matrix, dir) {
        // Transpose
        for (let y = 0; y < matrix.length; ++y) {
            for (let x = 0; x < y; ++x) {
                [matrix[x][y], matrix[y][x]] = [matrix[y][x], matrix[x][y]];
            }
        }
        // Reverse rows (CW) atau Reverse matrix (CCW)
        if (dir > 0) {
            matrix.forEach(row => row.reverse());
        } else {
            matrix.reverse();
        }
        return matrix;
    }

    const handleInput = (action) => {
        if(isPaused) return;
        if(action === 'left') { player.pos.x--; if(collide(arena, player)) player.pos.x++; }
        if(action === 'right') { player.pos.x++; if(collide(arena, player)) player.pos.x--; }
        if(action === 'down') { player.pos.y++; if(collide(arena, player)) { player.pos.y--; merge(arena, player); playerReset(); arenaSweep(); } }
        if(action === 'rotate-cw' || action === 'rotate-ccw') { 
            const dir = action === 'rotate-cw' ? 1 : -1;
            const oldX = player.pos.x;
            const oldMatrix = player.matrix.map(row => [...row]); // Simpan state lama
            
            rotateM(player.matrix, dir);
            
            // Wall Kick (Mencegah terjepit di dinding saat berputar)
            let offset = 1;
            while(collide(arena, player)) {
                player.pos.x += offset;
                offset = -(offset + (offset > 0 ? 1 : -1));
                if(Math.abs(offset) > player.matrix[0].length) { 
                    player.matrix = oldMatrix; // Kembalikan jika gagal
                    player.pos.x = oldX; 
                    return; 
                }
            }
            // Animasi Feedback Rotasi
            canvas.style.transform = `scale(1.03) rotate(${dir * 1}deg)`;
            setTimeout(() => canvas.style.transform = 'scale(1) rotate(0deg)', 100);
        }
        if(action === 'hard') {
            while(!collide(arena, player)) player.pos.y++;
            player.pos.y--; merge(arena, player); playerReset(); arenaSweep();
        }
    }

    const bindBtn = (id, act) => {
        const el = document.getElementById(id);
        el.addEventListener('touchstart', (e) => { e.preventDefault(); handleInput(act); });
        el.addEventListener('mousedown', () => handleInput(act));
    }

    bindBtn('c-left', 'left');
    bindBtn('c-right', 'right');
    bindBtn('c-down', 'down');
    bindBtn('c-rotate-cw', 'rotate-cw');
    bindBtn('c-rotate-ccw', 'rotate-ccw');
    bindBtn('c-hard', 'hard');

    document.addEventListener('keydown', e => {
        if(isPaused) return;
        const keys = {
            37:'left', 
            39:'right', 
            40:'down', 
            38:'rotate-cw', 
            88:'rotate-cw', // Tombol X
            90:'rotate-ccw', // Tombol Z
            32:'hard'
        };
        if(keys[e.keyCode]) handleInput(keys[e.keyCode]);
    });

    function updateHighScore() {
        const best = localStorage.getItem('aether_best') || 0;
        document.getElementById('high-score-ui').innerText = best.toString().padStart(4, '0');
    }

    window.onload = () => {
        resizeBG();
        drawBG();
        updateHighScore();
        setTimeout(() => {
            document.getElementById('loader').style.opacity = '0';
            setTimeout(() => document.getElementById('loader').style.display = 'none', 1000);
        }, 2000);
    };
    window.onresize = resizeBG;

</script>
</body>
</html>